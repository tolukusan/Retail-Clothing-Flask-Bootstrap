{% extends "base.html" %}
{% block title %}{{ product.name }} Details{% endblock %}

{% block content %}
<div class="product-detail-container">
    <!-- Breadcrumb -->
    <nav class="breadcrumb-nav">
        <a href="{{ url_for('main.index') }}" class="breadcrumb-link">
            <i class="bi bi-house-door"></i> Home
        </a>
        <i class="bi bi-chevron-right breadcrumb-separator"></i>
        <a href="{{ url_for('main.product_list') }}" class="breadcrumb-link">Store</a>
        <i class="bi bi-chevron-right breadcrumb-separator"></i>
        <span class="breadcrumb-current">{{ product.name }}</span>
    </nav>

    <div class="row g-4">
        <!-- Left Column: Image Gallery -->
        <div class="col-lg-6">
            <div class="product-image-gallery">
                <div class="main-image-container">
                    <img src="{{ url_for('static', filename=product.image_url) }}"
                        class="main-product-image" alt="{{ product.name }}" id="mainImage">
                    
                    <!-- Image Badge -->
                    <div class="image-badge">
                        <i class="bi bi-gem"></i> Premium Quality
                    </div>
                </div>
            </div>
            
            <!-- Back to Shop Button -->
            <a href="{{ url_for('main.product_list') }}" class="back-to-shop-btn">
                <i class="bi bi-arrow-left"></i>
                <span>Back to Shop</span>
            </a>
        </div>

        <!-- Right Column: Product Details -->
        <div class="col-lg-6">
            <div class="product-details-section">
                <!-- Product Header -->
                <div class="product-header">
                    <div class="product-meta">
                        <span class="product-category-badge">
                            <i class="bi bi-tag-fill"></i> {{ product.category|capitalize }}
                        </span>
                        <span class="product-sku">SKU: {{ product.sku }}</span>
                    </div>
                    <h1 class="product-detail-title">{{ product.name }}</h1>
                </div>

                <!-- Price Section -->
                <div class="price-section">
                    <div class="main-price">
                        <span class="currency">Â£</span>
                        <span class="amount">{{ product.price|round(2) }}</span>
                    </div>
                    <div class="price-info">
                        <i class="bi bi-shield-check"></i> Secure Payment Available
                    </div>
                </div>

                <!-- Stock Status -->
                <div class="stock-section">
                    {% if product.stock_level > 5 %}
                    <div class="stock-status in-stock">
                        <i class="bi bi-check-circle-fill"></i>
                        <div class="stock-text">
                            <strong>In Stock</strong>
                            <span>{{ product.stock_level }} units available</span>
                        </div>
                    </div>
                    {% elif product.stock_level > 0 %}
                    <div class="stock-status low-stock">
                        <i class="bi bi-exclamation-triangle-fill"></i>
                        <div class="stock-text">
                            <strong>Low Stock</strong>
                            <span>Only {{ product.stock_level }} units left</span>
                        </div>
                    </div>
                    {% else %}
                    <div class="stock-status out-stock">
                        <i class="bi bi-x-circle-fill"></i>
                        <div class="stock-text">
                            <strong>Out of Stock</strong>
                            <span>Currently unavailable</span>
                        </div>
                    </div>
                    {% endif %}
                </div>

                <!-- Description -->
                <div class="description-section">
                    <h3 class="section-heading">
                        <i class="bi bi-file-text"></i> Product Description
                    </h3>
                    <p class="product-description-text">{{ product.desc }}</p>
                </div>

                <!-- Features -->
                <div class="features-section">
                    <div class="feature-item">
                        <i class="bi bi-truck"></i>
                        <div>
                            <strong>Fast Delivery</strong>
                            <span>2-5 business days</span>
                        </div>
                    </div>
                    <div class="feature-item">
                        <i class="bi bi-arrow-clockwise"></i>
                        <div>
                            <strong>Easy Returns</strong>
                            <span>30-day return policy</span>
                        </div>
                    </div>
                    <div class="feature-item">
                        <i class="bi bi-shield-check"></i>
                        <div>
                            <strong>Authentic</strong>
                            <span>100% genuine products</span>
                        </div>
                    </div>
                </div>

                <!-- Add to Cart Section -->
                <div class="cart-section">
                    {% if product.stock_level > 0 %}
                        {% if not current_user.is_authenticated %}
                        <div class="login-notice">
                            <i class="bi bi-info-circle-fill"></i>
                            <span>Please <a href="{{ url_for('auth.login') }}" class="login-link">log in</a> to add this item to your cart</span>
                        </div>
                        <button class="add-to-cart-main disabled" disabled>
                            <i class="bi bi-lock-fill"></i>
                            <span>Login Required</span>
                        </button>
                        {% else %}
                        <!-- Quantity Selector -->
                        <div class="quantity-section">
                            <label class="quantity-label">
                                <i class="bi bi-123"></i> Quantity
                            </label>
                            <div class="quantity-controls">
                                <button type="button" class="qty-btn qty-decrease" onclick="decreaseQuantity()">
                                    <i class="bi bi-dash"></i>
                                </button>
                                <input type="number" id="quantity" name="quantity" value="1" min="1" max="{{ product.stock_level }}" class="qty-input" readonly>
                                <button type="button" class="qty-btn qty-increase" 
                                        onclick="increaseQuantity()" 
                                        data-max-stock="{{ product.stock_level or 0 }}">
                                    <i class="bi bi-plus"></i>
                                </button>
                            </div>
                        </div>
                        
                        <form method="POST" action="{{ url_for('cart.add_to_cart', product_id=product.prod_id) }}" class="cart-form" id="cartForm">
                            <input type="hidden" name="quantity" id="quantityInput" value="1">
                            <button type="submit" class="add-to-cart-main">
                                <i class="bi bi-cart-plus-fill"></i>
                                <span>Add to Cart</span>
                                <i class="bi bi-arrow-right"></i>
                            </button>
                        </form>
                        {% endif %}
                    {% else %}
                    <button class="add-to-cart-main disabled" disabled>
                        <i class="bi bi-x-circle-fill"></i>
                        <span>Currently Unavailable</span>
                    </button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function decreaseQuantity() {
    const qtyInput = document.getElementById('quantity');
    const quantityInput = document.getElementById('quantityInput');
    let currentValue = parseInt(qtyInput.value);
    
    if (currentValue > 1) {
        currentValue--;
        qtyInput.value = currentValue;
        quantityInput.value = currentValue;
    }
}

function increaseQuantity() {
    const qtyInput = document.getElementById('quantity');
    const quantityInput = document.getElementById('quantityInput');
    const increaseBtn = document.querySelector('.qty-increase');
    const maxStock = parseInt(increaseBtn.getAttribute('data-max-stock')) || 0;
    
    let currentValue = parseInt(qtyInput.value);
    
    if (currentValue < maxStock) {
        currentValue++;
        qtyInput.value = currentValue;
        quantityInput.value = currentValue;
    }
}

// Update the max attribute when quantity changes (optional enhancement)
function updateMaxQuantity() {
    const qtyInput = document.getElementById('quantity');
    const increaseBtn = document.querySelector('.qty-increase');
    const maxStock = parseInt(increaseBtn.getAttribute('data-max-stock')) || 0;
    qtyInput.setAttribute('max', maxStock);
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    updateMaxQuantity();
});
</script>
{% endblock %}